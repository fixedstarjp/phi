(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setupMessageListener()},n=[{key:"setupMessageListener",value:function(){var e=this;chrome.runtime.onMessage.addListener(function(t,n,o){switch(console.log("Content script received message:",t),t.type){case"GET_PAGE_CONTENT":return e.getPageContent(o),!0;case"GET_SELECTION":return e.getSelection(o),!0;case"SUMMARIZE":return e.handleContextMenuSummarize(t.text),!0;case"TRANSLATE":return e.handleContextMenuTranslate(t.text),!0;default:return o({success:!1,error:"Unknown request type"}),!0}})}},{key:"getPageContent",value:function(e){try{e({success:!0,content:this.extractMainContent()})}catch(t){e({success:!1,error:t.message})}}},{key:"extractMainContent",value:function(){for(var e="",t=0,n=["main","article",'[role="main"]',".content",".main-content","#content","#main","body"];t<n.length;t++){var o=n[t],r=document.querySelector(o);if(r&&(e=this.extractTextFromElement(r)).length>100)break}return e.length<100&&(e=this.extractTextFromElement(document.body)),e.length>2e3&&(e=e.substring(0,2e3)+"..."),e}},{key:"extractTextFromElement",value:function(e){e.querySelectorAll("script, style, noscript").forEach(function(e){return e.remove()});var t=e.innerText||e.textContent||"";return t.replace(/\s+/g," ").trim()}},{key:"getSelection",value:function(e){try{var t=window.getSelection().toString().trim();e({success:!0,text:t,hasSelection:t.length>0})}catch(t){e({success:!1,error:t.message})}}},{key:"handleContextMenuSummarize",value:function(e){var t=this;this.showToast("要約を生成中...","info"),chrome.runtime.sendMessage({type:"SUMMARIZE_TEXT",text:e},function(e){e.success?(t.showToast("要約完了","success"),t.showResultModal("要約結果",e.response)):t.showToast("要約エラー","error")})}},{key:"handleContextMenuTranslate",value:function(e){var t=this;this.showToast("翻訳中...","info"),chrome.runtime.sendMessage({type:"TRANSLATE_TEXT",text:e},function(e){e.success?(t.showToast("翻訳完了","success"),t.showResultModal("翻訳結果",e.response)):t.showToast("翻訳エラー","error")})}},{key:"showToast",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=document.getElementById("phi4-toast");n&&n.remove();var o=document.createElement("div");o.id="phi4-toast",o.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: ".concat("success"===t?"#28a745":"error"===t?"#dc3545":"#007bff",";\n      color: white;\n      padding: 12px 20px;\n      border-radius: 6px;\n      z-index: 10000;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n      animation: slideIn 0.3s ease-out;\n    ");var r=document.createElement("style");r.textContent="\n      @keyframes slideIn {\n        from { transform: translateX(100%); opacity: 0; }\n        to { transform: translateX(0); opacity: 1; }\n      }\n    ",document.head.appendChild(r),o.textContent=e,document.body.appendChild(o),setTimeout(function(){o.parentNode&&o.remove()},3e3)}},{key:"showResultModal",value:function(e,t){var n=document.getElementById("phi4-modal");n&&n.remove();var o=document.createElement("div");o.id="phi4-modal",o.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0,0,0,0.5);\n      z-index: 10001;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    ";var r=document.createElement("div");r.style.cssText="\n      background: white;\n      padding: 20px;\n      border-radius: 8px;\n      max-width: 500px;\n      max-height: 70vh;\n      overflow-y: auto;\n      box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n    ",r.innerHTML='\n      <h3 style="margin-top: 0; color: #333; font-size: 18px;">'.concat(e,'</h3>\n      <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 6px; line-height: 1.6; color: #333;">\n        ').concat(t,'\n      </div>\n      <button id="phi4-close-modal" style="\n        background: #007bff;\n        color: white;\n        border: none;\n        padding: 10px 20px;\n        border-radius: 6px;\n        cursor: pointer;\n        font-size: 14px;\n        float: right;\n      ">閉じる</button>\n      <div style="clear: both;"></div>\n    '),o.appendChild(r),document.body.appendChild(o),document.getElementById("phi4-close-modal").addEventListener("click",function(){o.remove()}),o.addEventListener("click",function(e){e.target===o&&o.remove()})}}],n&&t(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}())})();